{% extends "myapp/base.html" %}

{% block content %}
<div class="content">
    <form method="post" onsubmit="showLoadingMessage()">
        {% csrf_token %}
        <div class="form-group">
            <label for="start_date">Start Date:</label>
            <input type="date" id="start_date" name="start_date" required>
        </div>
        <div class="form-group">
            <label for="end_date">End Date:</label>
            <input type="date" id="end_date" name="end_date" required>
        </div>
        <div class="button-group">
            <button type="button" class="time-button" onclick="setDateRange(7)">1 Week</button>
            <button type="button" class="time-button" onclick="setDateRange(30)">1 Month</button>
            <button type="button" class="time-button" onclick="setDateRange(90)">3 Months</button>
            <button type="button" class="time-button" onclick="setDateRange(180)">6 Months</button>
            <button type="button" class="time-button" onclick="setDateRange(365)">1 Year</button>
            <button type="button" class="reset-btn" onclick="resetDateFields()">Reset</button>
        </div>
        <button type="submit" class="submit-btn">Analyze</button>
    </form>

    <!-- Loading message overlay -->
    <div id="loadingMessage" class="loading-overlay" style="display: none;">
        <button class="analyzing-btn" disabled>Analyzing...</button>
    </div>

    <!-- Results container, hidden until form submission -->
    <div id="resultsContainer" class="results-container" style="display: none;">
        <div class="card">
            <h2>Above Nifty50</h2>
            <div class="card-content">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Percentage Change</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for company in abovenifty50_final %}
                        <tr>
                            <td>{{ company.Company }}</td>
                            <td>{{ company.PercentageChange|floatformat:2 }}%</td>
                            <td><a href="{{ company.Links }}" target="_blank">Details</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <h2>Below Nifty50</h2>
            <div class="card-content">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Percentage Change</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for company in belownifty50_final %}
                        <tr>
                            <td>{{ company.Company }}</td>
                            <td>{{ company.PercentageChange|floatformat:2 }}%</td>
                            <td><a href="{{ company.Links }}" target="_blank">Details</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    function showLoadingMessage() {
        // Show the loading overlay
        document.getElementById('loadingMessage').style.display = 'flex';

        // Hide the results container until the results are ready
        document.getElementById('resultsContainer').style.display = 'none';
    }

    function setDateRange(days) {
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');

        // Calculate the start and end dates
        const endDate = new Date();
        const startDate = new Date();
        startDate.setDate(endDate.getDate() - days);

        // Format dates as YYYY-MM-DD
        startDateInput.value = startDate.toISOString().split('T')[0];
        endDateInput.value = endDate.toISOString().split('T')[0];
    }

    function resetDateFields() {
        // Clear the date input fields
        document.getElementById('start_date').value = '';
        document.getElementById('end_date').value = '';
    }

    // Once the page loads, check if there are results and show the results container
    window.onload = function() {
        {% if abovenifty50_final or belownifty50_final %}
            document.getElementById('resultsContainer').style.display = 'flex';
            document.getElementById('loadingMessage').style.display = 'none';
        {% endif %}
    };
</script>


{% endblock content %}
